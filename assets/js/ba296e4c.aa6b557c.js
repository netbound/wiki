"use strict";(self.webpackChunkalexandria=self.webpackChunkalexandria||[]).push([[461],{1177:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return p},default:function(){return h}});var o=n(7462),a=n(3366),i=(n(7294),n(3905)),r=["components"],s={id:"staking",title:"Staking on Ethereum with Rocketpool",tags:["ethereum","erigon","lighthouse"],sidebar_position:1},l="Staking on Ethereum with Rocketpool",c={unversionedId:"ethereum/staking",id:"ethereum/staking",isDocsHomePage:!1,title:"Staking on Ethereum with Rocketpool",description:"To participate as a validator in Ethereum consensus, we have to stake 32 ETH, which is a lot. With Rocketpool, node operators",source:"@site/docs/ethereum/staking.md",sourceDirName:"ethereum",slug:"/ethereum/staking",permalink:"/ethereum/staking",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/ethereum/staking.md",tags:[{label:"ethereum",permalink:"/tags/ethereum"},{label:"erigon",permalink:"/tags/erigon"},{label:"lighthouse",permalink:"/tags/lighthouse"}],version:"current",sidebarPosition:1,frontMatter:{id:"staking",title:"Staking on Ethereum with Rocketpool",tags:["ethereum","erigon","lighthouse"],sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Intro",permalink:"/"},next:{title:"Concurrency in Go",permalink:"/go/concurrency-in-go"}},p=[{value:"Execution Node: Erigon",id:"execution-node-erigon",children:[{value:"Statistics",id:"statistics",children:[]},{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Installation",id:"installation",children:[]}]},{value:"Consensus Node: Lighthouse",id:"consensus-node-lighthouse",children:[{value:"Prerequisites",id:"prerequisites-1",children:[]},{value:"Installation",id:"installation-1",children:[]}]},{value:"Rocketpool",id:"rocketpool",children:[]},{value:"Setup",id:"setup",children:[{value:"Setting up the services",id:"setting-up-the-services",children:[]},{value:"Installing Rocketpool",id:"installing-rocketpool",children:[]},{value:"Firewall (using UFW)",id:"firewall-using-ufw",children:[]},{value:"Configuring Rocketpool",id:"configuring-rocketpool",children:[]}]},{value:"Running",id:"running",children:[{value:"Starting the Rocketpool Service",id:"starting-the-rocketpool-service",children:[]},{value:"Setting up a Wallet",id:"setting-up-a-wallet",children:[]},{value:"Loading up the Funds",id:"loading-up-the-funds",children:[]},{value:"Registering the Node",id:"registering-the-node",children:[]},{value:"Setting up a Minipool",id:"setting-up-a-minipool",children:[]}]},{value:"Sources",id:"sources",children:[]}],d={toc:p};function h(e){var t=e.components,n=(0,a.Z)(e,r);return(0,i.kt)("wrapper",(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"staking-on-ethereum-with-rocketpool"},"Staking on Ethereum with Rocketpool"),(0,i.kt)("p",null,"To participate as a validator in Ethereum consensus, we have to stake 32 ETH, which is a lot. With Rocketpool, node operators\nonly require 16 ETH to get started, and since that's all I have right now, this is what this document covers. This guide assumes\na Linux machine, and I'm using Ubuntu 20.04 LTS."),(0,i.kt)("h2",{id:"execution-node-erigon"},"Execution Node: Erigon"),(0,i.kt)("p",null,"For our execution node, we'll go with ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ledgerwatch/erigon"},"Erigon"),". Erigon is a modular Ethereum archive node\nwith a very efficient initial sync that runs in stages, and a relatively small, flat key-value database store. Erigon is\nwritten in Go, and there are some other clients on the way that follow this new architecture, e.g.\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/torquem-ch/silkworm"},"Silkworm (C++)")," and ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/akula-bft/akula"},"Akula (Rust)"),"."),(0,i.kt)("p",null,"Archive nodes store and validate the complete Ethereum chain, right from block 0. This can be interesting if you want\nto inspect historical events, and do historical transaction tracing. There are some cool projects that build on these\nproperties of Erigon:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://trueblocks.io/"},"Trueblocks"),", a chain indexer to query the Ethereum blockchain"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/wmitsuda/otterscan"},"Otterscan"),", a block explorer like Etherscan, but local (and faster)")),(0,i.kt)("p",null,"Another fact about Erigon is that it is built in a modular way - you can run the RPC API, the transaction pool, or even the\np2p stack as different processes that communicate back to the main erigon process over gRPC. "),(0,i.kt)("p",null,"The modular architecture brings with it some great benefits, including the ability to run multiple rpcdaemons at once, or run\nthe rpcdaemon on another machine. We'll just do it because there are some RPC methods that require a separate rpcdaemon.\nYou can find more info on their ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ledgerwatch/erigon/wiki"},"Github Wiki"),"."),(0,i.kt)("h3",{id:"statistics"},"Statistics"),(0,i.kt)("p",null,"Syncing an Erigon archive node took around 76 hours in total on the following machine:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"CPU: AMD Ryzen 9 3900x (12 cores, 4.6 GHz)"),(0,i.kt)("li",{parentName:"ul"},"SSD: logical volume of 1 2TB Corsair Force MP600 and one 2TB Seagate Ironwolf 510"),(0,i.kt)("li",{parentName:"ul"},"RAM: 64GB of DDR4 (Corsair Vengeance, 2x 32 GB modules)")),(0,i.kt)("p",null,"The sync consumed 700 GB of network traffic, and the total database size is 1.6 TB. If you run\na geth node in archive mode, you'll need more than 6 TB of disk space."),(0,i.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://go.dev/doc/install"},"Install Go"))),(0,i.kt)("h3",{id:"installation"},"Installation"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"git clone --recurse-submodules -j8 https://github.com/ledgerwatch/erigon.git\ncd erigon\ngit checkout stable\nmake erigon\n")),(0,i.kt)("p",null,"We'll run the RPC API, ",(0,i.kt)("inlineCode",{parentName:"p"},"rpcdaemon")," in Erigon lingo, as a separate process, so we have to build that too:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"make rpcdaemon\n")),(0,i.kt)("p",null,"After building, we'll move the erigon directory to ",(0,i.kt)("inlineCode",{parentName:"p"},"/srv"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo mv erigon /srv/\n")),(0,i.kt)("p",null,"This is the location where our systemd services will start the processes from."),(0,i.kt)("h2",{id:"consensus-node-lighthouse"},"Consensus Node: Lighthouse"),(0,i.kt)("p",null,"As a consensus node, we're going to install Lighthouse, built with Rust."),(0,i.kt)("h3",{id:"prerequisites-1"},"Prerequisites"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.rust-lang.org/tools/install"},"Install Rust"))),(0,i.kt)("h3",{id:"installation-1"},"Installation"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/sigp/lighthouse.git\ncd lighthouse\ngit checkout stable\nmake\n\n# Move to system directory\nsudo mv lighthouse /srv/\n")),(0,i.kt)("p",null,"To update:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"cd /srv/lighthouse\ngit fetch\ngit checkout ${VERSION}\nmake\n")),(0,i.kt)("h2",{id:"rocketpool"},"Rocketpool"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Rocket Pool is the base layer protocol for decentralised and trustless ETH2 staking.")),(0,i.kt)("p",null,"With Rocketpool, node operators can collaborate with stakers to create validators. A node operator (us) runs the infrastructure\n(execution, beacon node and validator), and stakes 16 ETH of his own together with some ",(0,i.kt)("strong",{parentName:"p"},"RPL")," tokens (10% of staked ETH) as collateral for slashing and performance insurance.\nStakers can more easily participate because they only require a small amount of ETH to get started. Essentially, Rocketpool splits the difference between those who have the technical skills to run and maintain a node and those who lack the financial capacity to own 32 ETH."),(0,i.kt)("p",null,"As a node operator, you'll also get more ROI in the form of the slashing insurance premiums (RPL) and a commission rate (ETH)."),(0,i.kt)("h2",{id:"setup"},"Setup"),(0,i.kt)("p",null,"We're going to run the execution and consensus clients as ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Systemd"},"systemd")," services,\neach with their own service accounts. The service accounts will have limited access to the rest of the system,\nso if one of the clients is compromised, the damage will be contained. The Rocketpool smart node stack will run in Docker containers.\nThis is the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.rocketpool.net/guides/node/hybrid.html"},"Hybrid Rocket Pool Node")," configuration."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Storage")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The disks you will use as storage should be SSDs, HDD won't cut it. I've mounted some NVMe drives as logical volumes,\nso that I can easily increase capacity in the future. Stats:"),(0,i.kt)("ul",{parentName:"div"},(0,i.kt)("li",{parentName:"ul"},"Erigon drive: 4 TB (right now, state is about 1.6 TB) NVMe"),(0,i.kt)("li",{parentName:"ul"},"Lighthouse drive: 1 TB NVMe")))),(0,i.kt)("h3",{id:"setting-up-the-services"},"Setting up the services"),(0,i.kt)("p",null,"Let's start by creating the service accounts (without login) and service groups:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# -r is for system account, -s specifies shell\nsudo useradd -r -s /sbin/nologin erigon\nsudo useradd -r -s /sbin/nologin lighthouse\n\n# service group\nsudo groupadd ethereum\n")),(0,i.kt)("p",null,"Next, change the ownership of the client directories:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo chown -R erigon:ethereum /srv/erigon\nsudo chown -R lighthouse:ethereum /srv/lighthouse\n")),(0,i.kt)("p",null,"We have to be part of the ",(0,i.kt)("inlineCode",{parentName:"p"},"ethereum")," group with our main account to have write access\nto the directories (for updating):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo usermod -aG ethereum $USER\n")),(0,i.kt)("h4",{id:"systemd-service-files"},"Systemd service files"),(0,i.kt)("p",null,"We'll need the following systemd services:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Erigon execution client"),(0,i.kt)("li",{parentName:"ul"},"Rpcdaemon for Erigon"),(0,i.kt)("li",{parentName:"ul"},"Lighthouse beacon node")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-service",metastring:'title="/etc/systemd/system/erigon.service"',title:'"/etc/systemd/system/erigon.service"'},"[Unit]\nDescription=Erigon\nAfter=network.target\n\n[Service]\nType=simple\nUser=erigon\nRestart=always\nRestartSec=5\nExecStart=/srv/erigon/build/bin/erigon --datadir /mnt/eth-archive --maxpeers 100\n\n[Install]\nWantedBy=multi-user.target\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text",metastring:'title="/etc/systemd/system/rpcdaemon.service"',title:'"/etc/systemd/system/rpcdaemon.service"'},"[Unit]\nDescription=Rpcdaemon\nAfter=network.target erigon.service\nWants=erigon.service\nPartOf=erigon.service\n\n[Service]\nType=simple\nUser=erigon\nRestart=always\nRestartSec=5\nExecStart=/srv/erigon/build/bin/rpcdaemon --datadir /mnt/eth-archive --ws --http.addr 0.0.0.0 --http.api eth,net,trace,erigon,web3\n\n[Install]\nWantedBy=multi-user.target\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-service",metastring:'title="/etc/systemd/system/lh-bn.service"',title:'"/etc/systemd/system/lh-bn.service"'},"[Unit]\nDescription=Lighthouse Beacon Node\nAfter=network.target rpcdaemon.service\nWants=rpcdaemon.service\nPartOf=rpcdaemon.service\n\n[Service]\nType=simple\nUser=lighthouse\nRestart=always\nRestartSec=5\nExecStart=/srv/lighthouse/target/release/lighthouse beacon --network mainnet --datadir /mnt/evo/lighthouse --port 9001 --discovery-port 9001 --eth1 --eth1-endpoints http://localhost:8545 --http --http-address 0.0.0.0 --http-port 5052 --eth1-blocks-per-log-query 150 --disable-upnp\n\n[Install]\nWantedBy=multi-user.target\n")),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Listening addresses")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The HTTP addresses on rpcdaemon and Lighthouse were changed to 0.0.0.0, because the Rocketpool node, which runs in a Docker container,\notherwise can't reach them. But beware, these APIs are now listening on public interfaces, so make sure your firewall is running."))),(0,i.kt)("h3",{id:"installing-rocketpool"},"Installing Rocketpool"),(0,i.kt)("h4",{id:"installing-the-cli"},"Installing the CLI"),(0,i.kt)("p",null,"We download the CLI following ",(0,i.kt)("a",{parentName:"p",href:"https://docs.rocketpool.net/guides/node/docker.html#downloading-the-rocket-pool-cli"},"this Rocketpool guide"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"wget https://github.com/rocket-pool/smartnode-install/releases/latest/download/rocketpool-cli-linux-amd64 -O ./rocketpool\n# Mark as executable and move to somewhere in $PATH\nchmod +x ./rocketpool && sudo mv ./rocketpool /usr/local/bin\n")),(0,i.kt)("p",null,"Test running it with the ",(0,i.kt)("inlineCode",{parentName:"p"},"--version")," flag, which should output something like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ rocketpool --version\n\nrocketpool version 1.1.0\n")),(0,i.kt)("h4",{id:"installing-the-smartnode-stack"},"Installing the Smartnode Stack"),(0,i.kt)("p",null,"We can install the Smartnode Stack for mainnet like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"rocketpool service install\n")),(0,i.kt)("p",null,"Next, add yourself to the ",(0,i.kt)("inlineCode",{parentName:"p"},"docker")," group to use Docker without root privileges:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo usermod -aG docker $USER\n")),(0,i.kt)("p",null,"You will have to restart your SSH session for these changes to take effect."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Docker installation")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"This will download Docker and docker-compose for you, if you already have these installed, run:"),(0,i.kt)("pre",{parentName:"div"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"rocketpool service install -d \n")),(0,i.kt)("p",{parentName:"div"},"This will tell rocketpool to skip the dependencies."))),(0,i.kt)("h4",{id:"basic-configuration"},"Basic Configuration"),(0,i.kt)("p",null,"Run the following command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"rocketpool service config\n")),(0,i.kt)("p",null,"This will start an interactive process to help with the configuration.\nFor our ETH1 client, even though we're using Erigon, you can select Geth (1) and leave all the default options.\nWe will later modify these."),(0,i.kt)("p",null,"For the ETH2 configuration, make sure to select Lighthouse. This is important, since the validator node\nis part of the Smartnode Stack and needs to be the same client as our Beacon Node. The default settings will do, but you can\nadd your own custom Graffiti! This will be included on every block your validator produces, which is pretty cool."),(0,i.kt)("p",null,"As we've seen, the Smartnode Stack runs with docker-compose. We'll need to change the original compose file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="~/.rocketpool/docker-compose.yml"',title:'"~/.rocketpool/docker-compose.yml"'},'version: "3.4"\nservices:\n  eth1:\n    image: ${ETH1_IMAGE}\n    ...\n  eth2:\n    image: ${ETH2_IMAGE}\n    ...\n    depends_on:\n      - eth1\n  validator:\n    image: ${VALIDATOR_IMAGE}\n    ...\n    depends_on:\n      - eth2\n  api:\n    image: ${SMARTNODE_IMAGE}\n    ...\n    depends_on:\n      - eth1\n    entrypoint: /bin/sleep\n    command: "infinity"\n  node:\n    image: ${SMARTNODE_IMAGE}\n    ...\n    depends_on:\n      - eth1\n      - eth2\n  watchtower:\n    image: ${SMARTNODE_IMAGE}\n    ...\n    depends_on:\n      - eth1\n      - eth2\n')),(0,i.kt)("p",null,"Delete both the ",(0,i.kt)("inlineCode",{parentName:"p"},"eth1")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"eth2")," sections of the configuration, and if they are in another services' ",(0,i.kt)("inlineCode",{parentName:"p"},"depends_on")," section,\nremove them there too."),(0,i.kt)("h4",{id:"creating-docker-networks"},"Creating Docker Networks"),(0,i.kt)("p",null,"Right now, we're going to start and stop the smartnode stack. It won't work yet, but it will create the necessary Docker networks, which\nwe need for later configuration."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"rocketpool service start\nrocketpool service stop\n")),(0,i.kt)("p",null,"This will have created a Docker network ",(0,i.kt)("inlineCode",{parentName:"p"},"rocketpool_net"),". Find the subnet with:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'docker inspect rocketpool_net | jq .[0].IPAM.Config[0].Subnet\n\n# Example:\nSUBNET="172.18.0.0/16"\n')),(0,i.kt)("p",null,"We can now configure the firewall."),(0,i.kt)("h3",{id:"firewall-using-ufw"},"Firewall (using UFW)"),(0,i.kt)("p",null,"We need to open the correct ports on our machine:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'# Erigon\nsudo ufw allow 30303 comment "Erigon eth65 p2p"\nsudo ufw allow 30304 comment "Erigon eth66 p2p"\n\n# where $SUBNET is the Docker subnet you noted before\nsudo ufw allow from $SUBNET to any port 8545 comment "Rocketpool to Erigon"\n# Lighthouse\nsudo ufw allow 9001 comment "Lighthouse p2p"\n\nsudo ufw allow from $SUBNET to any port 5052 comment "Rocketpool to Lighthouse beacon node"\n')),(0,i.kt)("p",null,"Right now the APIs are only reacheable from inside the Docker containers. If you want to reach them from other machines on your network,\nconfigure the firewall accordingly."),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Port forwarding")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"If your machine is behind a router or firewall, make sure to configure port forwarding. This is important for maintaining good\nconnectivity and allowing other peers to discover you."))),(0,i.kt)("h3",{id:"configuring-rocketpool"},"Configuring Rocketpool"),(0,i.kt)("p",null,"We've already done some basic configuration in ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.rocketpool/docker-compose.yml"),", but we're not done yet.\nThe next file we need to configure is ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.rocketpool/config.yml"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="~/.rocketpool/config.yml"',title:'"~/.rocketpool/config.yml"'},"rocketpool:\n  ...\nsmartnode:\n  ...\nchains:\n  eth1:\n    provider: http://eth1:8545\n    wsProvider: ws://eth1:8546\n    ...\n  eth2:\n    provider: http://eth2:5052\n    ...\n")),(0,i.kt)("p",null,"The hosts that are filled in by default (",(0,i.kt)("inlineCode",{parentName:"p"},"eth1"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"eth2"),") are normally resolved inside of the Docker network.\nSince we're not running these services as Docker containers, we'll need to modify them. Replace\nall the providers with the gateway IP of ",(0,i.kt)("inlineCode",{parentName:"p"},"$SUBNET")," (if your SUBNET was ",(0,i.kt)("inlineCode",{parentName:"p"},"172.18.0.0/16"),", your http provider will\nbe ",(0,i.kt)("inlineCode",{parentName:"p"},"http://172.18.0.1:8545"),"). Your ws provider will be ",(0,i.kt)("inlineCode",{parentName:"p"},"ws://172.18.0.1:8545"),", since Erigon uses the same ports\nfor both HTTP and WebSockets. Do the same for the ",(0,i.kt)("inlineCode",{parentName:"p"},"eth2")," provider."),(0,i.kt)("p",null,"This networking setup will work since we configured UFW to accept connections coming from the Docker network."),(0,i.kt)("h2",{id:"running"},"Running"),(0,i.kt)("h3",{id:"starting-the-rocketpool-service"},"Starting the Rocketpool Service"),(0,i.kt)("p",null,"We have done enough configuration for now, and can finally start the service. Use this command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'rocketpool service start\n\nCreating network "rocketpool_net" with the default driver\nCreating rocketpool_api  ... \nCreating rocketpool_api  ... done\nCreating rocketpool_watchtower ... \nCreating rocketpool_node       ... \nCreating rocketpool_validator  ... \nCreating rocketpool_validator  ... done\nCreating rocketpool_node       ... done\nCreating rocketpool_watchtower ... done\n')),(0,i.kt)("p",null,"I have included the output, and this is more or less what your output should look like as well. "),(0,i.kt)("p",null,"If you need to stop the service to do some system maintenance or upgrade the rocketpool stack, use:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"rocketpool service stop\n\nAre you sure you want to pause the Rocket Pool service? Any staking minipools will be penalized! [y/n]\ny\n\nStopping rocketpool_node       ... \nStopping rocketpool_validator  ... \nStopping rocketpool_watchtower ... \nStopping rocketpool_api        ... \nStopping rocketpool_validator  ... done\nStopping rocketpool_node       ... done\nStopping rocketpool_watchtower ... done\nStopping rocketpool_api        ... done\n")),(0,i.kt)("h4",{id:"checking-the-services"},"Checking the Services"),(0,i.kt)("p",null,"We can check the service version and networks with ",(0,i.kt)("inlineCode",{parentName:"p"},"rocketpool service version"),"."),(0,i.kt)("p",null,"Checking if all the containers are running can be done with ",(0,i.kt)("inlineCode",{parentName:"p"},"docker ps"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'docker ps\n\nCONTAINER ID   IMAGE                         COMMAND                  CREATED       STATUS      PORTS                                                 NAMES\ncc23bb9f1f7c   sigp/lighthouse:v2.0.1        "sh /setup/start-val\u2026"   2 days ago    Up 2 days                                                         rocketpool_validator\n0cbe6a5f4997   rocketpool/smartnode:v1.1.0   "/go/bin/rocketpool \u2026"   2 days ago    Up 2 days                                                         rocketpool_node\na4223e20252e   rocketpool/smartnode:v1.1.0   "/go/bin/rocketpool \u2026"   2 days ago    Up 2 days                                                         rocketpool_watchtower\n681f8a9744c1   rocketpool/smartnode:v1.1.0   "/bin/sleep infinity"    2 days ago    Up 2 days                                                         rocketpool_api\nb1dc152f1391   grafana/grafana:8.1.1         "/run.sh"                8 weeks ago   Up 2 days   3000/tcp, 0.0.0.0:3100->3100/tcp, :::3100->3100/tcp   rocketpool_grafana\nfcfa50d3f3bf   prom/node-exporter:v1.2.2     "/bin/node_exporter \u2026"   8 weeks ago   Up 2 days                                                         rocketpool_exporter\ne274309e596a   prom/prometheus:v2.28.1       "/bin/prometheus --w\u2026"   8 weeks ago   Up 2 days   9090/tcp                                              rocketpool_prometheus\n')),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"This might look different if you didn't configure for analytics during the setup."))),(0,i.kt)("p",null,"Further logs can be obtained with ",(0,i.kt)("inlineCode",{parentName:"p"},"rocketpool service logs")," for all logs, or ",(0,i.kt)("inlineCode",{parentName:"p"},"rocketpool service logs <service>"),", to get the logs\nfor a specific service (",(0,i.kt)("inlineCode",{parentName:"p"},"validator")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"node")," for example)."),(0,i.kt)("h3",{id:"setting-up-a-wallet"},"Setting up a Wallet"),(0,i.kt)("p",null,"Now that all the services are running, we need to set up an ETH1 wallet for the node. This wallet will"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Hold ETH to pay for various actions on the network (creating a new minipool, staking your RPL)"),(0,i.kt)("li",{parentName:"ul"},"Hold the ETH that you're going to send to your minipool to start staking"),(0,i.kt)("li",{parentName:"ul"},"Hold the RPL that you're going to stake")),(0,i.kt)("p",null,"We're going to use the ",(0,i.kt)("inlineCode",{parentName:"p"},"rocketpool")," cli to create this wallet:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"rocketpool wallet init\n")),(0,i.kt)("p",null,"This will prompt you for a password to protect your private key and give you back a 24-word mnemonic that\nis your recovery phrase. Your password will be written to ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.rocketpool/data/password")," in CLEARTEXT, so make sure\nthere's no one else on your system. Your wallet private key is at ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.rocketpool/data/wallet"),"."),(0,i.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Please write down your recovery phrase, but KEEP IT SAFE. This phrase can be used to import your wallet\nand all validators attached to a new machine, and anyone that has this phrase has full control over your\nprivate key."))),(0,i.kt)("h3",{id:"loading-up-the-funds"},"Loading up the Funds"),(0,i.kt)("p",null,"Before we can create a minipool, we need 16 ETH, extra ETH for gas fees, and some RPL in our node wallet.\nThe RPL value should be at least 10% of the value of your ETH in USD. You can read more about the purpose of\nRPL in ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("a",{parentName:"strong",href:"#sources"},"[3]")),"."),(0,i.kt)("h3",{id:"registering-the-node"},"Registering the Node"),(0,i.kt)("p",null,"Once the funds are in the wallet, we can register our node with the Rocketpool network:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"rocketpool node register\n")),(0,i.kt)("p",null,"This will prompt you for your timezone, as well as sending a transaction. Make sure the gas price is not ridiculously high.\nYou can now check your RPL and ETH balances:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"rocketpool node status\n")),(0,i.kt)("p",null,"By default, all your RPL rewards, as well as your staked ETH and RPL will be sent to your wallet address when claiming the\nrewards or exiting your validator. If you want to change this, follow ",(0,i.kt)("a",{parentName:"p",href:"https://docs.rocketpool.net/guides/node/prepare-node.html#setting-your-withdrawal-address"},"this guide"),"."),(0,i.kt)("h3",{id:"setting-up-a-minipool"},"Setting up a Minipool"),(0,i.kt)("p",null,"This is where things get interesting, and potentially dangerous. Make sure you're ready to stake 16 or 32 ETH, as well as a\nnon-trivial amount of RPL. Also make sure your secrets are secret, and be diligent about it."),(0,i.kt)("h4",{id:"staking-rpl"},"Staking RPL"),(0,i.kt)("p",null,"The first step in setting up a validator is to stake your RPL. This should be at least 10% of the value of your ETH, and\nthe more you stake, the more you earn (capped at 150% of your ETH value). "),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"This stake counts for your entire node, so if\nyou want to run multiple minipools, this is possible without buying and staking more RPL."))),(0,i.kt)("p",null,"Start staking with the following command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"rocketpool node stake-rpl\n")),(0,i.kt)("p",null,"This will prompt you for the amount you want to stake, so you don't have to calculate it yourself:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Please choose an amount of RPL to stake:\n1: The minimum minipool stake amount (284.477473 RPL)?\n2: The maximum effective minipool stake amount (4267.162095 RPL)?\n3: Your entire RPL balance (1440.000000 RPL)?\n4: A custom amount\n")),(0,i.kt)("p",null,"On confirmation, you'll have to allow 2 transactions. Once these are confirmed, you can check your staked balance:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"rocketpool node status\n\nThe node has a total stake of 11763.477483 RPL and an effective stake of 11763.477483 RPL, allowing it to run 41 minipool(s) in total.\nThis is currently a 10.88% collateral ratio.\nThe node must keep at least 10810.143971 RPL staked to collateralize its minipools and claim RPL rewards.\n")),(0,i.kt)("p",null,"Make sure your collateral ratio is above 10%, or you won't be able to collect any RPL staking rewards."),(0,i.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Your nodes should be synced before moving on to the next step, or you will lose rewards."))),(0,i.kt)("h4",{id:"staking-eth-and-creating-a-minipool"},"Staking ETH and Creating a Minipool"),(0,i.kt)("p",null,"We're now ready to finally stake our ETH and put our node up to become a validator:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"rocketpool node deposit\n")),(0,i.kt)("p",null,"You will be prompted to deposit either 16 or 32 ETH, we'll be going with 16. This will put us in the minipool queue,\nwhere we wait for 16 ETH to become available from stakers in the rETH staking pool. Once we hit the front of the queue\nand the ETH is available, it will be combined with our own 16 ETH to create a minipool and deposit the 32 ETH to the\nBeacon Chain deposit contract. Thus our validator is born!"),(0,i.kt)("p",null,"First we have to confirm the transaction though. You will have to set a commission slippage rate, but chances are the commission\nrate is 5%, which is the lowest it can go. So just accept the suggested slippage rate. If this is not the case, you can read more\nabout it ",(0,i.kt)("a",{parentName:"p",href:"https://docs.rocketpool.net/guides/node/create-validator.html#depositing-eth-and-creating-a-minipool"},"here"),"."),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"This is an expensive transaction, and the total cost in ETH will be displayed in the prompt. Make sure you're okay with the cost\nbefore confirming."))),(0,i.kt)("h4",{id:"confirming-minipool-creation"},"Confirming Minipool Creation"),(0,i.kt)("p",null,"Confirming the succesful creation of the minipool can be done with the following command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"rocketpool minipool status\n")),(0,i.kt)("p",null,"Your minipool will go through a couple stages before being finalized. First, it will enter the ",(0,i.kt)("inlineCode",{parentName:"p"},"initialized")," stage,\nwhich means your minipool is currently in the queue waiting to be assigned 16 ETH from the network. You can check your\nposition in the queue ",(0,i.kt)("a",{parentName:"p",href:"https://www.rp-metrics-dashboard.com/dashboard/MAINNET"},"here"),", where you can enter your node address."),(0,i.kt)("p",null,"Once the ETH is received and 32 of it is sent to the Beacon Chain contract, you will enter the ",(0,i.kt)("inlineCode",{parentName:"p"},"prelaunch")," state. This is currently\na period of 12 hours wherein all kinds of checks are performed. After this period, your validator will be activated and the\nminipool will enter the ",(0,i.kt)("inlineCode",{parentName:"p"},"staking")," stage. You can also follow this process on ",(0,i.kt)("a",{parentName:"p",href:"https://beaconcha.in/"},"beaconcha.in")," (find\nyour validator public key by looking up your node minipool creation transaction on etherscan)."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"If at any time during the process something didn't work as expected, I suggest you to check your logs with ",(0,i.kt)("inlineCode",{parentName:"p"},"rocketpool service logs"),".\nAlso look at the logs of your Erigon and Lighthouse, as something might be wrong in that part of the stack as well."))),(0,i.kt)("p",null,"If you got here, you're now officially a validator on the Ethereum network, congratulations! There are a couple ways to check\nyour rewards:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"You can look at beaconcha.in, but this will only show rewards for the whole validator, or"),(0,i.kt)("li",{parentName:"ul"},"You can check out the Grafana dashboard that's running on port ",(0,i.kt)("inlineCode",{parentName:"li"},"3100")," (if you set it up), which will show you all kinds of cool metrics.\nRead more about them ",(0,i.kt)("a",{parentName:"li",href:"https://docs.rocketpool.net/guides/node/grafana.html#overview-of-the-rocket-pool-metrics-stack"},"here"),".\nI highly recommend setting this up!")),(0,i.kt)("h2",{id:"sources"},"Sources"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"[","1","]")," ",(0,i.kt)("a",{parentName:"p",href:"https://docs.rocketpool.net"},"Rocketpool Docs")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"[","2","]")," ",(0,i.kt)("a",{parentName:"p",href:"https://docs.rocketpool.net/guides/node/cli-intro.html"},"Rocketpool CLI Reference")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"[","3","]")," ",(0,i.kt)("a",{parentName:"p",href:"https://medium.com/rocket-pool/rocket-pool-staking-protocol-part-3-3029afb57d4c"},"Rocketpool staking protocol part 3")))}h.isMDXComponent=!0}}]);